!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Squigglier",[],e):"object"==typeof exports?exports.Squigglier=e():t.Squigglier=e()}(window,function(){return function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(t,e,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};e.__esModule=!0;var r=n(1),i=n(7),a=n(8),s=function(){function t(){}return t.expandSettingValue=function(t,e){return t?t.split(e).reduce(function(t,e){var n=e.split(/:/);return t[n[0]]=!(n.length>1)||n[1],t},{}):{}},t.checkIgnore=function(t,e,n,o){for(var r in n){var i=t.getAttribute(r)||e[r];if(o(n[r],i))return!0}return!1},t.applyValidGeometries=function(e,n){void 0===n&&(n={});var o=r.Animate.inspectSvg(e),i={},a=t.expandSettingValue(n.limit,/[\,\&]/),s=t.expandSettingValue(n.exclude,/[\,\&]/);for(var u in o.geos){var l=o.geos[u],c=t.expandSettingValue(l.getAttribute("style"),/\s*;\s*/);t.checkIgnore(l,c,a,function(t,e){return t!==(null==e?"default":e)})||t.checkIgnore(l,c,s,function(t,e){return t===(null==e?"default":e)})||(i[u]=l)}return i},t.geometriesToGeoMeta=function(e,n,r){var i=Object.keys(e).reduce(function(i,a){var s,u=e[a],l=u.getTotalLength(),c=l>=n,d=c?i.totalDrawableGeoLength+l:i.totalDrawableGeoLength,f=i.totalGeoLength+l,h=c?l/d*r:t.NONDRAWABLE_DURATION;return{totalDrawableGeoLength:d,totalGeoLength:f,totalDelay:0,geoData:o({},i.geoData,((s={})[a]=o({},i.geoData[a]||{},{geo:u,length:l,drawable:c,duration:h}),s))}},{totalGeoLength:0,totalDrawableGeoLength:0,totalDelay:0,geoData:{}}),a=i.geoData,s=Object.keys(a).reduce(function(t,e){return t+a[e].duration},0),u=r/s;return Object.keys(a).sort(function(t,e){return a[t].length>a[e].length?-1:1}).forEach(function(t){var e=a[t];e.duration*=u,e.delay=i.totalDelay,i.totalDelay+=e.duration}),i},t.withStyleSheet=function(t){var e=document.styleSheets&&document.styleSheets[0];e&&t(e)},t.defaultFloat=function(t,e){return null!=t&&parseFloat(t)?parseFloat(t):e},t.NONDRAWABLE_DURATION=.5,t.freehand=i.Freehand.render,t.fillin=a.FillIn.render,t}();e.Animations=s},function(t,e,n){"use strict";e.__esModule=!0;var o=function(){function t(){}return t.svgOverride=function(t,e){for(var n=0,o=Object.keys(e);n<o.length;n++){var r=o[n];t.setAttribute(r,e[r])}for(var i in t.childNodes){var a=t.childNodes[i];a instanceof SVGElement&&this.svgOverride(a,e)}},t.SVG_GEO_ELEMENTS=["circle","ellipse","line","path","polygon","polyline","rect","text"],t.inspectSvg=function(e,n){if(void 0===n&&(n={geos:[]}),-1!==t.SVG_GEO_ELEMENTS.indexOf(e.tagName))return n.geos.push(e),n;if("g"===e.tagName||"svg"===e.tagName)for(var o in e.childNodes)n=this.inspectSvg(e.childNodes[o],n);return n},t}();e.Animate=o},function(t,e,n){t.exports=n(3)},function(t,e,n){"use strict";e.__esModule=!0;var o=n(4);document.addEventListener("DOMContentLoaded",function(){return new o.SpriteLoader})},function(t,e,n){"use strict";e.__esModule=!0;var o=n(5),r=n(6),i=function(){function t(e){var n=this;if(this.sprites=[],!(e instanceof HTMLElement)){var o=null==e?document.body:e instanceof Document?e.body:null;o&&t.mapChildTags(o,"sprite",function(t){n.sprites.push(new a(t))})}}return t.eachElement=function(t,e){for(var n in t)t.hasOwnProperty(n)&&t[n]instanceof Element&&e(t[n])},t.mapChildTags=function(e,n,o){var r=e.getElementsByTagName(n.toLowerCase());t.eachElement(r,function(t){t.tagName.toLowerCase()===n.toLowerCase()&&o(t)})},t}();e.SpriteLoader=i;var a=function(){function t(t){this._state="dehydrated",this.actions={animations:[],filters:[]},this.events={},this.loadSource(t)}return t.prototype.loadSource=function(t){!t.getAttribute&&Array.isArray(t)&&(t=t[0]),this.target=t;var e=t.getAttribute("src");e&&this.loadObject(e)},t.prototype.loadObject=function(t){var e=this,n=new XMLHttpRequest;n.open("GET",t,!0),n.send(),n.onload=function(t){var o=n.responseXML.firstChild;o instanceof SVGElement?(e.loaded=o,e._state="hydrating",e.hydrate()):e._state="error"}},t.prototype.hydrate=function(){var t=this;if(this.loaded instanceof SVGSVGElement){this.attributesToActions(),this.scriptsToEvents();for(var e=0,n=this.actions.filters;e<n.length;e++){var r=n[e],i=r.action,a=r.settings;"function"==typeof o.Filters[i]&&o.Filters[i](this.loaded,a)}this.compileSequence(function(){t.target.outerHTML=t.loaded.outerHTML,console.log("HERE",t.target.getElementsByClassName("script")),t.addEvents(t.target),console.log("AFTER",t.target.getElementsByClassName("script"))})}else this._state="error"},t.prototype.addEvents=function(t){if(0!==Object.keys(this.events).length){var e=document.createElementNS(t.getAttribute("xmlns"),"script");e.setAttribute("type","text/javascript");var n=[];for(var o in this.events)n.push("\n        this.addEventListener('"+o.replace(/^on/,"")+"',\n          function(e) {\n            "+this.events[o]+"\n          }\n        )\n      ");console.log("3",e),t.appendChild(e),console.log(t)}},t.prototype.attributesToActions=function(){for(var t=this,e=0,n=Object.keys(this.target.attributes);e<n.length;e++){var o=n[e],r=this.target.attributes[o];if(!this.loaded.attributes.hasOwnProperty(r.name)){switch(r.name){case"animation":r.value.split(/\s*;\s*/).forEach(function(e){return t.actions.animations.push(t.parseSettings(e))});break;case"filter":r.value.split(/\s*;\s*/).forEach(function(e){return t.actions.filters.push(t.parseSettings(e))})}this.loaded.setAttribute(r.name,r.value)}}},t.prototype.parseSettings=function(t){for(var e=t.split(/\s+/),n=e.shift(),o={},r=0,i=e;r<i.length;r++){var a=i[r].split(/=/),s=a[0],u=a[1];o[s]=void 0===u||u}return{action:n,settings:o}},t.prototype.addEventHandler=function(t,e){this.events[t]="\n"+e+"\n"},t.prototype.scriptsToEvents=function(){var e=this;i.mapChildTags(this.target,"events",function(n){console.log("events",n),i.eachElement(n.childNodes,function(n){-1!==t.SPRITE_EVENTS.indexOf(n.tagName.toLowerCase())&&e.addEventHandler(n.tagName.toLowerCase(),n.innerHTML)})})},t.prototype.compileSequence=function(t){r.Sequence.attach(this.loaded).addActions(this.actions).finally(t).run()},t.prototype.state=function(){return this._state},t.SPRITE_EVENTS=["onbegin","onend","onrepeat","onabort","onerror","onresize","onscroll","onunload","oncopy","oncut","onpaste","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncuechange","ondblclick","ondrag","ondragend","ondragenter","ondragexit","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onfocus","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onload","onloadeddata","onloadedmetadata","onloadstart","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onmousewheel","onpause","onplay","onplaying","onprogress","onratechange","onreset","onresize","onscroll","onseeked","onseeking","onselect","onshow","onstalled","onsubmit","onsuspend","ontimeupdate","ontoggle","onvolumechange","onwaiting","onactivate","onfocusin","onfocusout"],t}()},function(t,e,n){"use strict";e.__esModule=!0;var o=n(1),r=function(){function t(){}return t.animate=function(t,e){void 0===e&&(e={}),o.Animate.svgOverride(t,e)},t}();e.Filters=r},function(t,e,n){"use strict";e.__esModule=!0;var o=n(0),r=n(9),i=function(){function t(t){this.sequenceItems=[],this._index=0,this.actionSettings={},this._element=t,this._style=new r.SVGStyle(this._element)}return t.prototype.element=function(){return this._element},t.prototype.index=function(){return this._index},t.prototype.style=function(){return this._style},t.attach=function(e){return new t(e)},t.prototype.settings=function(t){void 0===t&&(t={}),this.actionSettings=t},t.prototype.run=function(){var t=this;this._index++,0===this.sequenceItems.length&&(this._style.render(),"function"==typeof this.finalSequenceItem&&this.finalSequenceItem());var e=this.sequenceItems.shift();if(!e)return this;var n=e.action,r=e.settings;return Object.keys(this.actionSettings).forEach(function(e){if(void 0===r[e])return r[e]=t.actionSettings[e].toString(),t;isNaN(r[e])||isNaN(t.actionSettings[e])||(r[e]=(parseFloat(r[e])+parseFloat(t.actionSettings[e])).toString())}),o.Animations[n](r,this),this},t.prototype.finally=function(t){return this.finalSequenceItem=t,this},t.prototype.addActions=function(t){for(var e=0,n=t.animations;e<n.length;e++){var r=n[e],i=r.action,a=r.settings;"function"==typeof o.Animations[i]&&this.sequenceItems.push({action:i,settings:a})}return this},t}();e.Sequence=i},function(t,e,n){"use strict";e.__esModule=!0;var o=n(0),r=function(){function t(){}return t.render=function(t,e){void 0===t&&(t={});var n=e.element().getAttribute("id"),r=o.Animations.defaultFloat(t.width,30),i=o.Animations.defaultFloat(t.minLength,0),a=o.Animations.defaultFloat(t.duration,5),s=void 0!==t.await,u=o.Animations.applyValidGeometries(e.element(),t),l=o.Animations.geometriesToGeoMeta(u,i,a);Object.keys(l.geoData).forEach(function(t){var o=l.geoData[t],i=n+"-"+e.index()+"-"+t;if(!o.drawable)return o.geo.classList.add(i+"-tiny"),e.style().keyframes(i+"-freehand").add({from:{opacity:0},to:{opacity:1}}),void e.style().selector("."+i+"-tiny").add({opacity:0,animation:i+"-freehand 0s linear forwards","animation-delay":o.delay+"s"});var a=document.createElementNS(e.element().getAttribute("xmlns"),"mask");a.setAttribute("id",i+"-mask"),a.setAttribute("maskUnits","userSpaceOnUse"),a.innerHTML='<path class="'+i+'-mask" d="'+o.geo.getAttribute("d")+'"/>',e.element().append(a),o.geo.setAttribute("mask","url(#"+i+"-mask)"),e.style().selector("#"+i+"-mask").add({fill:"none",stroke:"white","stroke-width":r,"stroke-dasharray":o.length+" "+o.length,"stroke-dashoffset":""+o.length,animation:i+"-freehand "+o.duration+"s linear forwards","animation-delay":o.delay+"s"}),e.style().keyframes(i+"-freehand").add({from:{"stroke-dashoffset":o.length},to:{"stroke-dashoffset":0}})}),e.settings({delay:s?l.totalDelay:0}),e.run()},t}();e.Freehand=r},function(t,e,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};e.__esModule=!0;var r=n(0),i=function(){function t(){}return t.render=function(t,e){void 0===t&&(t={});var n=r.Animations.applyValidGeometries(e.element(),t),i=e.element().getAttribute("id"),a=r.Animations.defaultFloat(t.opacity,0),s=r.Animations.defaultFloat(t.delay,0),u=r.Animations.defaultFloat(t.duration,0),l=t.fill;Object.keys(n).forEach(function(t){var r=n[t],c=i+"-"+e.index()+"-"+t,d=i+"-fill-"+t;e.style().keyframes(c+"-opacity").add({from:{opacity:0},to:o({},l?{fill:l}:{},{opacity:a})}),r.classList.add(d),e.style().selector("."+d).add({animation:c+"-opacity "+u+"s linear "+s+"s forwards"})}),e.run()},t}();e.FillIn=i},function(t,e,n){"use strict";e.__esModule=!0;var o=function(){function t(t){this.rules={},this.type=t}return t.prototype.add=function(t,e){this.rules[t]=(this.rules[t]?this.rules[t]:[]).concat(this.toArray(e))},t.prototype.css=function(){var t=this,e="KEYFRAMES"===this.type?"@keyframes ":"",n="KEYFRAMES"===this.type?"":":";return Object.keys(this.rules).map(function(o){var r=t.rules[o].reduce(function(t,e){return Object.keys(e).forEach(function(n){t[n]=(t[n]?t[n]:[]).concat(e[n])}),t},{});return""+e+o+" {\n"+Object.keys(r).map(function(e){return""+e+n+" "+("KEYFRAMES"===t.type?"{"+r[e].map(function(t){return Object.keys(t).map(function(e){return e+": "+t[e]+"; "})})+"}":r[e].join(", ")+";")}).join("\n")+"\n}\n"}).join("\n")},t.prototype.toArray=function(t){return Array.isArray(t)?t:[t]},t}();e.RuleFamily=o;var r=function(){function t(t,e){this.ruleFamily=t,this.id=e}return t.prototype.add=function(t){return this.ruleFamily.add(this.id,t),this},t}();e.IdentifiedRuleAdder=r;var i=function(){function t(t){this.ruleFamily=t}return t.prototype.add=function(t,e){return this.ruleFamily.add(t,e),this},t}();e.UnidentifiedRuleAdder=i;var a=function(){function t(t){this.rules={keyframes:new o("KEYFRAMES"),selector:new o("SELECTOR")},this.element=t}return t.prototype.wrap=function(t,e){return t?{add:function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return n?2===n.length&&"string"==typeof n[0]&&"object"==typeof n[1]?e.add(n[0],n[1]):1===n.length&&"object"==typeof n[0]?e.add(t,n[0]):e:e}}:{add:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t&&2===t.length&&"string"==typeof t[0]&&"object"==typeof t[1]?e.add(t[0],t[1]):e}}},t.prototype.render=function(){var t=[this.rules.keyframes.css(),this.rules.selector.css()].join("\n");this.styleSheet=document.createElement("style"),this.styleSheet.innerHTML=t,this.element.insertAdjacentElement("afterbegin",this.styleSheet)},t.prototype.keyframes=function(t){return this.wrap(t,this.rules.keyframes)},t.prototype.selector=function(t){return this.wrap(t,this.rules.selector)},t}();e.SVGStyle=a}])});
//# sourceMappingURL=squigglier.js.map